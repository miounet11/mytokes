# Kiro å·¥å…·è°ƒç”¨ä¿®å¤ - å®æ–½æ£€æŸ¥æ¸…å•

## ğŸ“‹ å‡†å¤‡é˜¶æ®µ

- [ ] **é˜…è¯»æ–‡æ¡£**
  - [ ] `SOLUTION_SUMMARY.md` - äº†è§£é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
  - [ ] `QUICK_REFERENCE.md` - å¿«é€Ÿå‚è€ƒ
  - [ ] `INTEGRATION_GUIDE.md` - è¯¦ç»†é›†æˆæ­¥éª¤

- [ ] **å¤‡ä»½ç°æœ‰ä»£ç **
  ```bash
  cp api_server.py api_server.py.backup
  cp -r . ../ai-history-manager-backup-$(date +%Y%m%d-%H%M%S)
  ```

- [ ] **éªŒè¯ç¯å¢ƒ**
  ```bash
  python3 --version  # ç¡®ä¿ Python 3.7+
  pip list | grep httpx  # ç¡®ä¿å·²å®‰è£… httpx
  ```

---

## ğŸ§ª æµ‹è¯•é˜¶æ®µ

- [ ] **è¿è¡Œè½¬æ¢å™¨æµ‹è¯•**
  ```bash
  python3 test_kiro_converter.py
  ```
  **é¢„æœŸè¾“å‡º**ï¼š
  ```
  âœ“ æµ‹è¯• 1: ç®€å•æ¶ˆæ¯
  âœ“ æµ‹è¯• 2: å·¥å…·è°ƒç”¨
  âœ“ æµ‹è¯• 3: å†å²æ¶ˆæ¯äº¤æ›¿ä¿®å¤
  âœ“ æµ‹è¯• 4: Assistant å†…å®¹è§£æ
  âœ“ æµ‹è¯• 5: User å·¥å…·ç»“æœè§£æ
  âœ“ æµ‹è¯• 6: å¤æ‚å¯¹è¯
  æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
  ```

- [ ] **æ£€æŸ¥æµ‹è¯•ç»“æœ**
  - [ ] æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡
  - [ ] æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Šï¼ˆé™¤äº†é¢„æœŸçš„è­¦å‘Šï¼‰

---

## ğŸ”§ é›†æˆé˜¶æ®µ

### æ­¥éª¤ 1: å¯¼å…¥è½¬æ¢å™¨

- [ ] **åœ¨ `api_server.py` é¡¶éƒ¨æ·»åŠ å¯¼å…¥**
  ```python
  from kiro_converter import convert_anthropic_to_kiro
  ```

- [ ] **éªŒè¯å¯¼å…¥**
  ```bash
  python3 -c "from kiro_converter import convert_anthropic_to_kiro; print('å¯¼å…¥æˆåŠŸ')"
  ```

### æ­¥éª¤ 2: ä¿®æ”¹é…ç½®

- [ ] **æ·»åŠ  Kiro API ç«¯ç‚¹é…ç½®**
  ```python
  # åœ¨ api_server.py é¡¶éƒ¨æ·»åŠ 
  KIRO_API_URL = "https://api.kiro.ai/v1/converse"
  KIRO_STREAM_URL = "https://api.kiro.ai/v1/converse-stream"
  ```

- [ ] **ç¡®è®¤ KIRO_API_KEY å·²é…ç½®**
  ```bash
  echo $KIRO_API_KEY  # æˆ–æ£€æŸ¥ä»£ç ä¸­çš„é…ç½®
  ```

### æ­¥éª¤ 3: ä¿®æ”¹ `/v1/messages` ç«¯ç‚¹

- [ ] **æ‰¾åˆ° `handle_anthropic_messages` å‡½æ•°**
  - ä½ç½®ï¼š`api_server.py` çº¦ç¬¬ 1100 è¡Œ

- [ ] **æ›¿æ¢è¯·æ±‚å¤„ç†é€»è¾‘**
  - [ ] åˆ é™¤æ—§çš„ OpenAI æ ¼å¼è½¬æ¢ä»£ç 
  - [ ] æ·»åŠ  Kiro æ ¼å¼è½¬æ¢è°ƒç”¨
  - [ ] ä¿®æ”¹ API ç«¯ç‚¹ URL

- [ ] **å‚è€ƒå®ç°**ï¼ˆè§ `INTEGRATION_GUIDE.md` æ­¥éª¤ 1ï¼‰

### æ­¥éª¤ 4: åˆ é™¤å†…è”æ–‡æœ¬æ ¼å¼ä»£ç 

- [ ] **åˆ é™¤å·¥å…·è°ƒç”¨çš„å†…è”æ–‡æœ¬è½¬æ¢**
  - ä½ç½®ï¼š`api_server.py` çº¦ç¬¬ 1220-1227 è¡Œ
  ```python
  # åˆ é™¤è¿™æ®µä»£ç 
  if item_type == "tool_use":
      tool_name = item.get("name", "unknown")
      tool_input = item.get("input", {})
      input_str = json.dumps(tool_input, ensure_ascii=False)
      text_parts.append(f"[Calling tool: {tool_name}]\nInput: {input_str}")
  ```

- [ ] **åˆ é™¤å·¥å…·ç»“æœçš„å†…è”æ–‡æœ¬è½¬æ¢**
  - ä½ç½®ï¼š`api_server.py` çº¦ç¬¬ 1228-1259 è¡Œ
  ```python
  # åˆ é™¤è¿™æ®µä»£ç 
  if item_type == "tool_result":
      # ... å†…è”æ–‡æœ¬å¤„ç†
  ```

### æ­¥éª¤ 5: å®ç°éæµå¼å¤„ç†

- [ ] **åˆ›å»º `handle_kiro_non_stream` å‡½æ•°**
  - å‚è€ƒ `INTEGRATION_GUIDE.md` æ­¥éª¤ 2

- [ ] **å…³é”®ç‚¹æ£€æŸ¥**
  - [ ] ä½¿ç”¨ `KIRO_API_URL`
  - [ ] å‘é€ `kiro_request`ï¼ˆä¸æ˜¯ `anthropic_body`ï¼‰
  - [ ] æ­£ç¡®è§£æ Kiro å“åº”
  - [ ] è½¬æ¢å› Anthropic æ ¼å¼

### æ­¥éª¤ 6: å®ç°æµå¼å¤„ç†

- [ ] **åˆ›å»º `handle_kiro_stream` å‡½æ•°**
  - å‚è€ƒ `INTEGRATION_GUIDE.md` æ­¥éª¤ 3

- [ ] **å…³é”®ç‚¹æ£€æŸ¥**
  - [ ] ä½¿ç”¨ `KIRO_STREAM_URL`
  - [ ] æ­£ç¡®å¤„ç† SSE äº‹ä»¶
  - [ ] è½¬æ¢ Kiro æµå¼å“åº”ä¸º Anthropic æ ¼å¼

---

## âœ… éªŒè¯é˜¶æ®µ

### æœ¬åœ°æµ‹è¯•

- [ ] **å¯åŠ¨æœåŠ¡å™¨**
  ```bash
  python3 api_server.py
  ```
  **é¢„æœŸè¾“å‡º**ï¼š
  ```
  INFO:     Started server process
  INFO:     Uvicorn running on http://0.0.0.0:8000
  ```

- [ ] **æµ‹è¯• 1: ç®€å•å¯¹è¯ï¼ˆéæµå¼ï¼‰**
  ```bash
  curl -X POST http://localhost:8000/v1/messages \
    -H "Content-Type: application/json" \
    -H "x-api-key: your-key" \
    -d '{
      "model": "claude-sonnet-4",
      "max_tokens": 1024,
      "messages": [{"role": "user", "content": "Hello!"}]
    }'
  ```
  **é¢„æœŸ**ï¼šæ”¶åˆ°æ­£å¸¸çš„ JSON å“åº”

- [ ] **æµ‹è¯• 2: å·¥å…·è°ƒç”¨ï¼ˆéæµå¼ï¼‰**
  ```bash
  curl -X POST http://localhost:8000/v1/messages \
    -H "Content-Type: application/json" \
    -H "x-api-key: your-key" \
    -d '{
      "model": "claude-opus-4",
      "max_tokens": 2048,
      "messages": [{"role": "user", "content": "What is 2+2?"}],
      "tools": [{
        "name": "Calculator",
        "description": "Calculate math expressions",
        "input_schema": {
          "type": "object",
          "properties": {"expression": {"type": "string"}},
          "required": ["expression"]
        }
      }]
    }'
  ```
  **é¢„æœŸ**ï¼š
  - å“åº”åŒ…å« `tool_use` ç±»å‹çš„ content
  - å·¥å…·è°ƒç”¨æ ¼å¼æ­£ç¡®

- [ ] **æµ‹è¯• 3: æµå¼å“åº”**
  ```bash
  curl -X POST http://localhost:8000/v1/messages \
    -H "Content-Type: application/json" \
    -H "x-api-key: your-key" \
    -d '{
      "model": "claude-sonnet-4",
      "max_tokens": 1024,
      "messages": [{"role": "user", "content": "Count to 5"}],
      "stream": true
    }'
  ```
  **é¢„æœŸ**ï¼š
  - æ”¶åˆ° SSE äº‹ä»¶æµ
  - åŒ…å« `message_start`, `content_block_delta`, `message_stop` ç­‰äº‹ä»¶

- [ ] **æµ‹è¯• 4: å¤šè½®å¯¹è¯**
  ```bash
  curl -X POST http://localhost:8000/v1/messages \
    -H "Content-Type: application/json" \
    -H "x-api-key: your-key" \
    -d '{
      "model": "claude-opus-4",
      "max_tokens": 2048,
      "messages": [
        {"role": "user", "content": "Hello"},
        {"role": "assistant", "content": "Hi! How can I help?"},
        {"role": "user", "content": "What did I just say?"}
      ]
    }'
  ```
  **é¢„æœŸ**ï¼šAssistant èƒ½æ­£ç¡®å¼•ç”¨å†å²æ¶ˆæ¯

### æ—¥å¿—æ£€æŸ¥

- [ ] **æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—**
  - [ ] æ²¡æœ‰é”™è¯¯æˆ–å¼‚å¸¸
  - [ ] çœ‹åˆ° "å·²è½¬æ¢ä¸º Kiro æ ¼å¼" æ—¥å¿—
  - [ ] çœ‹åˆ° "Kiro å“åº”æˆåŠŸ" æ—¥å¿—

- [ ] **æ£€æŸ¥ Kiro è¯·æ±‚æ ¼å¼**
  - [ ] å¯ç”¨ DEBUG æ—¥å¿—æŸ¥çœ‹å®Œæ•´è¯·æ±‚
  ```python
  import logging
  logging.basicConfig(level=logging.DEBUG)
  ```
  - [ ] éªŒè¯è¯·æ±‚åŒ…å« `conversationState`
  - [ ] éªŒè¯ `toolUses` æ ¼å¼æ­£ç¡®

### åŠŸèƒ½éªŒè¯

- [ ] **å·¥å…·è°ƒç”¨åŠŸèƒ½**
  - [ ] Kiro API æ­£ç¡®è¯†åˆ«å·¥å…·è°ƒç”¨
  - [ ] å·¥å…·è¢«æ‰§è¡Œ
  - [ ] å·¥å…·ç»“æœæ­£ç¡®è¿”å›

- [ ] **å†å²æ¶ˆæ¯åŠŸèƒ½**
  - [ ] å¤šè½®å¯¹è¯æ­£å¸¸
  - [ ] æ¶ˆæ¯äº¤æ›¿æ­£ç¡®
  - [ ] å·¥å…·è°ƒç”¨å†å²æ­£ç¡®

- [ ] **æµå¼å“åº”åŠŸèƒ½**
  - [ ] æµå¼è¾“å‡ºæ­£å¸¸
  - [ ] äº‹ä»¶æ ¼å¼æ­£ç¡®
  - [ ] æ²¡æœ‰æ–­æµæˆ–å¡é¡¿

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¦‚æœæµ‹è¯•å¤±è´¥

- [ ] **æ£€æŸ¥å¯¼å…¥**
  ```bash
  python3 -c "from kiro_converter import convert_anthropic_to_kiro"
  ```

- [ ] **æ£€æŸ¥ API å¯†é’¥**
  ```bash
  echo $KIRO_API_KEY
  ```

- [ ] **æ£€æŸ¥ç½‘ç»œè¿æ¥**
  ```bash
  curl -I https://api.kiro.ai
  ```

- [ ] **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
  - å¯ç”¨ DEBUG çº§åˆ«æ—¥å¿—
  - æ£€æŸ¥ Kiro è¯·æ±‚å’Œå“åº”

- [ ] **å¯¹æ¯”å‚è€ƒå®ç°**
  - æŸ¥çœ‹ `INTEGRATION_GUIDE.md`
  - ç¡®ä¿ä»£ç ç»“æ„ä¸€è‡´

### å¸¸è§é—®é¢˜

- [ ] **é—®é¢˜ï¼šå·¥å…·è°ƒç”¨ä¸å·¥ä½œ**
  - æ£€æŸ¥æ˜¯å¦åˆ é™¤äº†å†…è”æ–‡æœ¬æ ¼å¼ä»£ç 
  - æ£€æŸ¥ Kiro è¯·æ±‚ä¸­çš„ `toolUses` æ ¼å¼
  - è¿è¡Œ `test_kiro_converter.py` æµ‹è¯• 2

- [ ] **é—®é¢˜ï¼šå†å²æ¶ˆæ¯éªŒè¯å¤±è´¥**
  - æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº† `fix_history_alternation()`
  - æŸ¥çœ‹æ—¥å¿—ä¸­çš„è­¦å‘Šä¿¡æ¯
  - è¿è¡Œ `test_kiro_converter.py` æµ‹è¯• 3

- [ ] **é—®é¢˜ï¼šæµå¼å“åº”å¼‚å¸¸**
  - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„æµå¼ç«¯ç‚¹
  - æ£€æŸ¥ SSE äº‹ä»¶æ ¼å¼
  - æŸ¥çœ‹ `INTEGRATION_GUIDE.md` æ­¥éª¤ 3

---

## ğŸš€ éƒ¨ç½²é˜¶æ®µ

- [ ] **ä»£ç å®¡æŸ¥**
  - [ ] æ‰€æœ‰ä¿®æ”¹éƒ½å·²å®Œæˆ
  - [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
  - [ ] æ²¡æœ‰é—ç•™çš„è°ƒè¯•ä»£ç 

- [ ] **æ€§èƒ½æµ‹è¯•**
  - [ ] å“åº”æ—¶é—´æ­£å¸¸
  - [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸
  - [ ] å¹¶å‘å¤„ç†æ­£å¸¸

- [ ] **æ–‡æ¡£æ›´æ–°**
  - [ ] æ›´æ–° READMEï¼ˆå¦‚æœéœ€è¦ï¼‰
  - [ ] è®°å½•é…ç½®å˜æ›´
  - [ ] æ›´æ–° API æ–‡æ¡£

- [ ] **éƒ¨ç½²åˆ°ç”Ÿäº§**
  - [ ] å¤‡ä»½ç”Ÿäº§ç¯å¢ƒ
  - [ ] éƒ¨ç½²æ–°ä»£ç 
  - [ ] ç›‘æ§æ—¥å¿—å’Œé”™è¯¯
  - [ ] éªŒè¯ç”Ÿäº§ç¯å¢ƒåŠŸèƒ½

---

## ğŸ“Š æˆåŠŸæ ‡å‡†

å®Œæˆåï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

âœ… **åŸºæœ¬åŠŸèƒ½**
- [ ] ç®€å•å¯¹è¯æ­£å¸¸å·¥ä½œ
- [ ] æµå¼å“åº”æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

âœ… **å·¥å…·è°ƒç”¨åŠŸèƒ½**
- [ ] Kiro API æ­£ç¡®è¯†åˆ«å·¥å…·è°ƒç”¨
- [ ] å·¥å…·è¢«æ‰§è¡Œå¹¶è¿”å›ç»“æœ
- [ ] å·¥å…·è°ƒç”¨å†å²æ­£ç¡®

âœ… **é«˜çº§åŠŸèƒ½**
- [ ] å¤šè½®å¯¹è¯æ­£å¸¸
- [ ] å†å²æ¶ˆæ¯äº¤æ›¿æ­£ç¡®
- [ ] å·¥å…·ç»“æœé…å¯¹æ­£ç¡®
- [ ] Token ç»Ÿè®¡å‡†ç¡®

âœ… **è´¨é‡æŒ‡æ ‡**
- [ ] æ²¡æœ‰é”™è¯¯æˆ–è­¦å‘Šï¼ˆé™¤äº†é¢„æœŸçš„ï¼‰
- [ ] å“åº”æ—¶é—´ < 2 ç§’ï¼ˆéæµå¼ï¼‰
- [ ] æµå¼å“åº”å»¶è¿Ÿ < 500ms
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ“ å®Œæˆè®°å½•

**å®æ–½æ—¥æœŸ**ï¼š____________________

**å®æ–½äººå‘˜**ï¼š____________________

**æµ‹è¯•ç»“æœ**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ç”Ÿäº§ç¯å¢ƒéªŒè¯é€šè¿‡

**é‡åˆ°çš„é—®é¢˜**ï¼š

1. ___________________________________
2. ___________________________________
3. ___________________________________

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ___________________________________
2. ___________________________________
3. ___________________________________

**å¤‡æ³¨**ï¼š

___________________________________________
___________________________________________
___________________________________________

---

## ğŸ‰ æ­å–œï¼

å¦‚æœä½ å®Œæˆäº†æ‰€æœ‰æ£€æŸ¥é¡¹ï¼Œé‚£ä¹ˆ Kiro å·¥å…·è°ƒç”¨åŠŸèƒ½å·²ç»æˆåŠŸä¿®å¤ï¼

**ä¸‹ä¸€æ­¥**ï¼š
- ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- æŒç»­ä¼˜åŒ–æ€§èƒ½

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- æŸ¥çœ‹ `SOLUTION_SUMMARY.md`
- æŸ¥çœ‹ `INTEGRATION_GUIDE.md`
- æŸ¥çœ‹ `QUICK_REFERENCE.md`
